#!/usr/bin/env ruby

require 'optparse'
require 'poet'

options = {
  :ssh_config => File.expand_path('~/.ssh/config'),
  :verbose => false,
  :with => [],
  :dir => File.expand_path('~/.ssh/config.d')
}

optparse = OptionParser.new do|opts|
  opts.on('-h', '--help', 'Display this screen') do
    puts opts
    exit
  end
  opts.on('-d', '--dir DIR', '') do |dir|
    options[:dir] = File.expand_path(dir)
  end
  opts.on('-o', '--output FILE', '') do |file|
    options[:ssh_config] = file
  end
  opts.on('-v', '--verbose', 'Be verbose') do
    options[:verbose] = true
  end
  opts.on('--bootstrap [FILE]', '') do |file|
    options[:bootstrap] = File.expand_path(file || options[:ssh_config])
  end
  opts.on('-w', '--with CONFIG', 'Include an otherwise disabled config file') do |file|
    options[:with] += file.split(',')
    options[:with].each{|file| puts "Including #{file} even if disabled..."}
  end
end
optparse.parse!

Poet.application(options).run
